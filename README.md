# Phishing-Website-Detection 钓鱼网站检测


## 网络钓鱼背景介绍

网络钓鱼（phishing）是一种基于社会工程学的欺诈攻击行为，是一个长期存在、基于社交渠道的问题，每天都会影响多个细分市场以及各行各业的人。攻击者会尝试利用互联网使用者的天真制造一些具有诱惑性的网页、电子邮件等，通过发送大量欺骗性的 E-mai 和伪造的 WEB 地址链接或页面来进行诈骗活动，诱导使用者的不谨慎点击来非法获取他们的个人隐私信息及敏感财务数据，如个人姓名、手机号码、社交账号密码、身份证号码、银行账号甚至密码等。

网络钓鱼的攻击手段主要包括电子邮件、建立假冒网上银行（钓鱼url）、利用木马和黑客技术、利用用户弱口令等漏洞破解猜测用户账号和密码等，而目前流行度最高，也最容易使钓鱼者得手的手段便是通过钓鱼网站来诱骗使用者上当。

网络钓鱼网站及其邮件每天都发送给数百万个用户，因此仍然是网络安全的主要问题。

## 项目概括

网络钓鱼是网络钓鱼攻击者使用的诱骗技术之一，目的是获取受骗用户的个人详细信息。仿冒网站是一个模拟的网站，其外观看起来与合法网站相似，但目的地不同。用户毫无防备地在钓鱼网站上发布了他们的数据，并认为这些网站来自受信任的合法官方发布。

当今各种反网络钓鱼技术不断涌现，但是网络钓鱼者通过打破所有反网络钓鱼机制而带来了新技术。因此，需要一种有效的机制来预测网络钓鱼网站，以在点击网站之前能够确定该网站是否合法，避免用户误点钓鱼网站造成损失的事件发生。

本项目采用机器学习技术对预测任务进行建模，并使用监督学习算法（即`决策树分类`，`朴素贝叶斯分类`和`随机森林`）来预测结果。

## 算法说明

### 决策树分类算法

决策树（Decision Tree），又称判断树。决策树是一类常见的机器学习方法，通过历史数据得到的树结构模型对新数据进行分类预测。它以树形数据结构来展示决策规则和分类结果的模型，作为一种归纳学习算法，其重点是将看似无序、杂乱的已知实例，通过技术手段将它们转化成可以预测未知实例的树状模型，每一条从根结点（对最终分类结果贡献最大的属性）到叶子结点（最终分类结果）的路径都代表一条决策的规则。

一个决策树包含三种类型的节点： 1、决策节点 2、机会节点 3、终结点

![image](https://github.com/Cindyhahaha/Phishing-Website-Detection/blob/master/screenshots/decision%20tree%20structure.png)

决策树算法本项目中使用的是**决策树C5.0算法**，但会存在以下问题：

```
由于决策树算法若使用所有特征进行训练，对未知的测试数据未必有好的分类、泛化能力，即可能发生过拟合现象，此时可采用剪枝或随机森林。在决策树学习中将已生成的树进行简化的过程称为剪枝（pruning），剪枝是决策树学习算法对付过拟合的主要手段。剪枝从已生成的树上裁掉一些子树或叶结点，并将其根结点或父结点作为新的叶结点，从而简化模型。关于决策树剪枝和随机森林的对比，许多引用都表明，随机森林更适合
```

### 随机森林

随机森林是通过集成学习的思想将多棵树集成的一种算法，它的基本单元是决策树，而它的本质属于集成学习（Ensemble Learning）方法。

鉴于决策树容易过拟合的缺点，随机森林采用多个决策树的投票机制来改善决策树，我们假设随机森林使用了m棵决策树，那么就需要产生m个一定数量的样本集来训练每一棵树，如果用全样本去训练m棵决策树显然是不可取的，全样本训练忽视了局部样本的规律，对于模型的泛化能力是有害的。

**算法流程**

    1) 训练总样本数为N，有放回地从N个训练集中随机抽取n个作为此单颗树的训练样本；
    
    2) 训练样例的输入特征的个数为M，从M个输入特征里随机选择m个输入特征，m<<M，建立决策树；
    
    3) 每棵树都尽可能地生长，不需要剪枝。

**结果判定**

- 目标特征为数字类型：取t个决策树的平均值作为分类结果。
  
- 目标特征为类别类型：少数服从多数，取单棵树分类结果最多的那个类别作为整个随机森林的分类结果。

**优点**

- 在当前所有算法中，具有极好的准确率

- 能够有效地运行在大数据集上

- 能够处理具有高维特征的输入样本，而且不需要降维

- 能够评估各个特征在分类问题上的重要性

- 对于缺省值问题也能够获得很好得结果


## 数据集

本项目所用到的数据集将被划分为训练集和测试集。

文件`./extracted_csv_files/legitimate-urls.csv`包含1000个合法网站的urls，文件`./extracted_csv_files/phishing-urls.csv`包含1000个非法的钓鱼网站urls。

测试预测结果所用的urls存在文件`suspicious_websites.csv`中，预测结果存在文件`predict_results.csv`中。


## 所需库

```
pandas
train_test_split
RandomForestClassifier
confusion_matrix,accuracy_score
matplotlib.pyplot
numpy
urlparse
urlencode
re
BeautifulSoup
requests
whois
urllib.request
datetime
time
socket
HTTPError
prange
datetime
google
UserAgent
urllib.request
```

## 本项目主要涉及的步骤

1. _特征提取_
  
2. _数据预处理_
    
- 过滤提取的特征数据。（删除不必要的列以训练模型）
    
3. _训练模型_
  
    使用决策树C5.0算法训练模型
      - 计算模型的准确性
      
    使用随机森林模型训练模型
      - 计算模型的准确性

   通过对比模型的准确性，评估模型的性能，选择最适合此问题的模型

4. _评估模型并测试模型_
     - 通过在文件`suspicious_websites.csv`中输入待检测URL，对它是合法网站还是钓鱼网站进行分类
     

## 算法改进

1. 原分类方法的目的：

    将已知为合法网址和钓鱼网址的文件合并，通过数据集分割，训练模型来将label进行预测，并计算预测的准确率

2. 我们的改进：

    1) 将`suspicious_websites.csv`的待检测网址（纯测试集，与模型训练所用的测试集无交叉）进行特征提取、数据预处理
    
    2) 使用训练好的模型对待检测网址的label进行预测
    
    3) 给出预测结果（label=0,Legal; label=1,Phishing; else ERROR）
    
        input => suspicious websites
    
        output => Legal or Phishing or ERROR

3. 模型评估：

    提升是指给每个训练元组赋予权重，迭代地学习k个分类器序列，学习得到分类器Mi之后，更新权重，使得其后的分类器Mi+1“更关注”Mi误分的训练元组，最终提升的分类器M* 组合每个个体分类器，其中每个分类器投票的权重是其准确率的函数。
    在提升的过程中，训练元组的权重根据它们的分类情况调整，如果元组不正确地分类，则它的权重增加，如果元组正确分类，则它的权重减少。元组的权重反映对它们分类的困难程度，权重越高，越可能错误的分类。根据每个分类器的投票，如果一个分类器的误差率越低，提升就赋予它越高的表决权重。在建立分类器的时候，让具有更高表决权重的分类器对具有更高权重的元组进行分类，这样，建立了一个互补的分类器系列。所以能够提高分类的准确性。
